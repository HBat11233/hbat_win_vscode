define("js/site/main",function(t,e){function i(t){this.container=y(t);var e=[];this.container.find("li a").each(function(){e.push(y(this).attr("href").substr(1))}),this.menuIds=e,this.actived=null}function n(){this.started=!1,this.counterStart=450,this.counterEnd=515,this.counterInterval=20,this.rotateInterval=3e3,this.$counter=y("#browser .counter"),this.$imgs=y("#browser .img-rot"),this.calcCounterStyle()}function r(t){var e=y(t.target).parents("a.icon-text"),i=e.parent().find("a"),n=i.index(e),r=i.index(e.parent().find("a.active"));if(n==r)return!1;var o=e.parents(".section").find(".img-rot");i.eq(r).removeClass("active"),e.addClass("active"),o.removeClass("fade-out"),o.eq(r).removeClass("fade-in").addClass("fade-out");var a=o.eq(n);a.data("url")&&(a.css("background-image","url("+a.data("url")+")"),a.data("url","")),a.addClass("fade-in")}function o(t){t.bind("scroll.fullyEnterViewport",function(){y(".zoom",t).addClass("zoom-in")}).bind("scroll.exitViewport",function(){y(".zoom",t).removeClass("zoom-in")})}function a(){var t=y("#menu"),e=new i(t),n=t.height(),r=!0,o=x.create(y("#main"));if(o.enterViewport(function(){e.normal()}),o.fullyEnterViewport(function(){m(),r&&e.deactive()}),o.exitViewport(function(){v(),e.fixed(),r&&e.active(e.get(0))}),y(".section").each(function(t,i){var o=i.getAttribute("id");if(e.hasMenu(o)){var a=x.create(i,n);a.partiallyExitViewport(function(){if(r){var t=a.watchItem.getAttribute("id");e.getActived()!=t&&e.active(t)}}),a.fullyEnterViewport(function(){if(r){var t=y(a.watchItem),i=t.attr("id"),o=e.getIndex(i),s=t.offset().top,c=window.scrollY+n;(t.height()-n>y(window).height()||e.getActived()==e.get(o+1)&&s>=c||e.getActived()==e.get(o-1)&&c>=s||o==e.size()-1)&&e.active(i)}}),a.exitViewport(function(){r&&y(a.watchItem).trigger("scroll.exitViewport")});var s=x.create(i);s.fullyEnterViewport(function(){y(a.watchItem).trigger("scroll.fullyEnterViewport")})}}),y('a[href^="#"]').on("click",function(t){var i=y(this.getAttribute("href"));if(i.length){t.preventDefault(),r=!1,e.active(i.attr("id"));var o=i.offset().top;y("html, body").animate({scrollTop:o-n},700,function(){r=!0,y(".section").each(function(){y(this).trigger("scroll.exitViewport")}),i.trigger("scroll.fullyEnterViewport")})}}),location.hash){var a=location.hash.substr(1);e.hasMenu(a)&&setTimeout(function(){r=!1,e.active(a),window.scrollTo(0,y("#"+a).offset().top-n),r=!0},100)}}function s(){y(".section").each(function(t,e){var i=x.create(e);i.exitViewport(function(){y(i.watchItem).trigger("scroll.exitViewport")}),i.fullyEnterViewport(function(){y(i.watchItem).trigger("scroll.fullyEnterViewport")})})}function c(){o(y("#multiple-tasks"));var t=new n;y("#browser").bind("scroll.fullyEnterViewport",function(){t.start()}).bind("scroll.exitViewport",function(){t.reset()})}function u(){y(".img-rot-show").each(function(){var t=y(this),e=t.data("url");e&&(t.css("background-image","url("+e+")"),t.data("url",""))}),y("#start-menu .icons a").click(r),y("#file-manager .icons a").click(r),y("#notifications .icons a").click(r)}function l(){y("#weixin").mouseenter(function(){y(".weixin-qrcode").addClass("show")}).mouseleave(function(){y(".weixin-qrcode").removeClass("show")})}function h(){y("img","#intro, .weixin-qrcode").each(function(){y(this).attr("src",y(this).data("url"))})}function d(){y(".img-rot").each(function(){if(!y(this).hasClass("img-rot-show"))try{var t=new Image;t.src=y(this).data("url")}catch(e){}})}function f(){var t=-1;if("Microsoft Internet Explorer"==navigator.appName){var e=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=i.exec(e)&&(t=parseFloat(RegExp.$1))}return t}function p(){var t=new n;y("#browser .counter").text(t.counterEnd)}function v(){y("#top-link").show()}function m(){y("#top-link").hide()}function w(t){var e=t.video_files,i=y("#video-container"),n=y("#video-mask"),r=e[parseInt(Math.random()*e.length)],o=g();y(window).resize(y.throttle(300,g));var a=C.setup({container:"video-player",file:r,width:o[0],height:o[1],flashplayer:t.flashplayer});window.vplayer=a;var s=function(){i.hide(),n.hide(),a.stop(),y("#play-btn").trigger("player.stop")};y("#play-btn").click(function(){i.show(),n.show(),setTimeout(function(){a.play()},500),y("#play-btn").trigger("player.start")}),y(".close-btn",i).click(s),n.click(s),y("#video-container~div").click(s)}function g(){var t=900,e=500,i=Math.min(y(window).width(),t),n=e/(t/i),r=y(window).height()-70;return n>r&&(n=r,i=t/(e/n)),y("#video-container").css({"margin-left":-i/2}),y("#video-player").width(i).height(n),[i,n]}var y=t("components/jquery/jquery"),x=t("js/scrollMonitor");t("js/jquery-throttle-debounce");var C=t("js/site/video-player");i.prototype.fixed=function(){this.isFixed()||(this.container.addClass("fixed"),y("#menu-placeholder").show())},i.prototype.isFixed=function(){return this.container.hasClass("fixed")},i.prototype.hasMenu=function(t){return-1!=this.menuIds.indexOf(t)},i.prototype.getIndex=function(t){return this.menuIds.indexOf(t)},i.prototype.get=function(t){return t>=0&&t<this.menuIds.length?this.menuIds[t]:null},i.prototype.normal=function(){this.isFixed()&&(this.container.removeClass("fixed"),y("#menu-placeholder").hide())},i.prototype.getActived=function(){return this.actived},i.prototype.active=function(t){if(t!=this.actived){var e=this.getIndex(t);-1!=e&&(this.container.find("li").removeClass("active"),this.container.find('li a[href="#'+t+'"]').parent().addClass("active"),this.actived=t)}},i.prototype.deactive=function(){this.actived=null,this.container.find("li").removeClass("active")},i.prototype.size=function(){return this.menuIds.length},n.prototype.start=function(){this.reset(),this.calcCounterStyle(),this.incrCounter()},n.prototype.calcCounterStyle=function(){var t={width:581,centerX:234,centerY:162,fontSize:55,fontWidth:92},e=this.$imgs.width()/t.width,i=parseInt(t.fontSize*e),n=parseInt(t.fontWidth*e);this.$counter.css({"font-size":i,left:parseInt(t.centerX*e-n/2),top:parseInt(t.centerY*e-i/2)})},n.prototype.nextRotate=function(){this.rotateTimer=setTimeout(y.proxy(this,"rotate"),this.rotateInterval)},n.prototype.rotate=function(){this.$imgs.removeClass("fade-out"),this.$imgs.eq(this.current).removeClass("fade-in").addClass("fade-out");var t=this.current+1;t>=this.$imgs.length&&(t=0);var e=this.$imgs.eq(t);e.data("url")&&(e.css("background-image","url("+e.data("url")+")"),e.data("url","")),e.addClass("fade-in"),this.current=t,this.nextRotate()},n.prototype.incrCounter=function(){return this.counter>=this.counterEnd?void setTimeout(y.proxy(this,"nextRotate"),1e3):(this.counter++,this.$counter.text(this.counter),void(this.counterTimer=setTimeout(y.proxy(this,"incrCounter"),this.counterInterval)))},n.prototype.reset=function(){this.counterTimer&&clearTimeout(this.counterTimer),this.rotateTimer&&clearTimeout(this.rotateTimer),this.$counter.text("- - -"),this.counter=this.counterStart,this.$imgs.removeClass("fade-in").removeClass("fade-out").removeClass("img-rot-show"),this.$imgs.eq(0).addClass("img-rot-show"),this.current=0},e.init=function(t){if(w(t),y("#menu").is(":hidden")){u(),c(),s();var e=!1;y(window).resize(y.throttle(300,function(){!e&&y(window).width()>720&&(h(),l(),e=!0)}))}else{h(),u(),l();var i=f();i>-1&&8>=i?p():(a(),c(),d())}}});